#!/bin/bash
# License: The MIT License (MIT)
# Author Zuzzuc https://github.com/Zuzzuc

b64gzdecode(){
	# Input is $1 and optionally $2, where $1 is a string generated by b64gz.sh and $2 is either 'print' or 'evaluate'(defaults to print), to either print the decoded string to stdout or to evaluate the content of the string.
	if [ "$2" == "print" ] || [ -z $2 ];then
		echo "$1" | base64 -D | gzip -d
	elif [ "$2" == "evaluate" ];then
		eval "$(echo "$1" | base64 -D | gzip -d)"
	else
		return 1
	fi
}

# Import Basi.
b64gzdecode "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" "evaluate"

# Print information about what the script does.
echo -e "\nThis is a installer for Battlefield 1942 and its two DLC's.\nThis installer will require about 3GB of free disc space to function.\n\n"

# Pre install setup
workdir="/tmp/bf1942installer"
mkdir -p "$workdir"

# Check if Wine is not installed.
if [ ! -d "/Applications/Wine.app" ];then
	echo -ne "Wine does not appear to be correctly installed. Battlefield will not be able to run without Wine.\nWould you like to "
	#Wine="";
	while [ "$(echo "$Wine" | tr '[:upper:]' '[:lower:]')" != "y" ] && [ "$(echo "$Wine" | tr '[:upper:]' '[:lower:]')" != "n" ];do
		read -p "Install wine? Enter [Y]es or [N]o: " Wine
	done
	if [ "$Wine" == "y" ];then		
		BasiPath[0]="remote%http://www.zuzzuc.com/files/Wine.app.tar.gz"
		BasiLoc[0]="$workdir/Wine.app.tar.gz"
		BasiFileAction[0]='echo "Extracting archive";cat "$BasiActiveFile" | gzip -d | tar -xC "/Applications"'
		
		Basi
	fi
echo 
	echo -e "Note that this script will overwrite your winefiles. Do a backup of them now if you have anything of importance there."
	sleep 3
fi


# Prepare basi execution
BasiPath=(
	"remote%http://www.zuzzuc.com/files/bf1942/WineFilesBF1942.tar.gz"
	"remote%http://www.zuzzuc.com/files/bf1942/bf1942.iso"
	"remote%http://www.zuzzuc.com/files/bf1942/BattlefieldLauncher.sh"
)
BasiLoc=(
	"$workdir/WineFiles.tar.gz"
	"$HOME/Documents/Battlefield 1942.iso"
	"/Applications/Battlefield Launcher.command"
)
BasiFileAction=(
	'echo "Extracting archive";cat "$BasiActiveFile" | gzip -d | tar -xC "$HOME"'
	''
	'chmod u+x "$BasiActiveFile"'
)


# Start installation
Basi

# Post Operations
echo -e "\n\n\nBattlefield 1942 has been installed on your system.\nTo launch the game, go to you applications and open \"Battlefield Launcher.command\""
rm -rf "$workdir" 